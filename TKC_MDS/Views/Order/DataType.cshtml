@{
	ViewData["Title"] = "DataType";
}
<div id="kt_app_content" class="app-content flex-column-fluid">
	<!--begin::Content container-->
	<div id="kt_app_content_container" class="app-container container-xxl">

		<form onsubmit="return false" id="data_type_form">
		<!--begin::Row-->
		<div class="row gy-5 g-xl-10">
			<div class="col-xl-1  "></div>

			<!--begin::Col-->
			<div class="col-xl-10">
				<!--begin::Table Widget 5-->
				<div class="card card-flush h-xl-100">
					<!--begin::Card header-->
					<div class="card-header pt-7">
						<!--begin::Title-->
						<h3 class="card-title align-items-start flex-column">
							<span class="card-label fw-bold text-dark">รูปแบบข้อมูล</span>
						</h3>
						<!--end::Title-->
						<!--begin::Actions-->
						<!--end::Actions-->
					</div>
					<!--end::Card header-->
					<!--begin::Card body-->

					<div class="card-body table-responsive">
						<!--begin::Table-->
						<table class="table align-middle fs-6 gy-3" id="kt_table_widget_5_table">
							<!--begin::Table head-->
							<!--begin::Table row-->
							<tbody>
								<tr class="text-start  fw-bold fs-7 text-uppercase gs-0">
									<th class="text-end  text-gray-400 pe-3 min-w-100px">
										ลูกค้า :
									</th>
									<td class="text-end pe-3 min-w-50px">
											<select name="CustID" class="form-select form-select-sm form-select-solid w-200px " id="custumer_select">
										</select>
									</td>
								</tr>
								<tr class="text-start  fw-bold fs-7 text-uppercase gs-0">
									<th class="text-end  text-gray-400 pe-3 min-w-100px">
										ประเภทข้อมูล :
									</th>
									<td class="text-end pe-3 min-w-50px">
											<select name="TypeCode" class="form-select form-select-sm form-select-solid w-200px" id="select_data_type">
										</select>
									</td>
									<td class="text-start pe-3 min-w-50px">
										<button type="button" class="btn btn-primary"  onclick="showDialogAddUser()">
											เพิ่ม
										</button>
									</td>

								</tr>
								<tr class="text-start  fw-bold fs-7 text-uppercase gs-0">
									<th class="text-end  text-gray-400 pe-3 min-w-100px">
										เป็นข้อมูล
										P/O:
									</th>
									<td class="text-end pe-3 min-w-50px">
											<select name="FirmOrder" class="form-select form-select-sm form-select-solid w-200px ">
											<option value="true" selected="selected" >Yes</option>
											<option value="false">No</option>

										</select>
									</td>
									<th class="text-end  text-gray-400 pe-3 min-w-150px">
										สร้างรายงานMDSด้วย
										:
									</th>
										<td class="text-start pe-3 min-w-30px"> 
											<input type="checkbox" checked="checked" name="MakeMDS" value="true" onclick="clickCheckBox(this)">
										</td>
									<th class="text-end  text-gray-400 pe-3 min-w-100px">
										ใช้พิมพ์POS
										:
									</th>
										<td class="text-start pe-3 min-w-30px">
											<input type="checkbox" checked="checked" name="ForPOS" value="true" onclick="clickCheckBox(this)">
										</td>
								</tr>
								<tr class="text-start  fw-bold fs-7 text-uppercase gs-0">
									<th class="text-end  text-gray-400 pe-3 min-w-100px">
										แสดงในรายงานMDS :
									</th>
									<td class="text-end pe-3 min-w-50px">
											<select class="form-select form-select-sm form-select-solid w-200px " name="ShowInSch">
											<option value="true" selected="selected" >Yes</option>
											<option value="false">No</option>

										</select>
									</td>

								</tr>
								<tr class="text-start  fw-bold fs-7 text-uppercase gs-0">

									<th class="text-end  text-gray-400 pe-3 min-w-100px">
										รวมเข้ากับ
										:
									</th>
									<td class="text-end pe-3 min-w-50px">
											<select class="form-select form-select-sm form-select-solid w-200px"  name="MixedSchWith" id="select_mixSchWidth">
											<option value="" selected="selected" >99-ไม่รวม</option>
											<option value="">98-รวม</option>

										</select>
									</td>
								</tr>
								<tr class="text-start  fw-bold fs-7 text-uppercase gs-0">
									<th class="text-end  text-gray-400 pe-3 min-w-100px">
										ลบข้อมูลก่อนนำเข้า :
									</th>
									<td class="text-start pe-3 min-w-30px text-danger">
											<input type="checkbox" checked="checked" name="DeleteOld" value="true" onclick="clickCheckBox(this)">
										*ลบข้อมูลเก่าที่ชื่อไฟล์เหมือนกัน
									</td>
								</tr>
								<tr class="text-start  fw-bold fs-7 gs-0">
									<th class="text-end  text-gray-400 pe-3 min-w-100px">
										หนึ่งแถวข้อมูลมีหลายDue :
									</th>
										<td class="text-start pe-3 min-w-30px"> 
											<input type="checkbox" checked="checked" name="RowManyDue" value="true" onclick="clickCheckBox(this)">
										</td>
								</tr>
								<tr class="text-start  fw-bold fs-7  gs-0">
									<th class="text-end  text-gray-400 pe-3 min-w-100px"></th>
									<td class="text-start pe-3 min-w-30px">
										<div class="form-group">
											<div class="radio-inline">
												<label class="radio">
														<input type="radio" name="ManyDueType" value="true" checked>
													<span></span>
													Due สลับกับ Qty
												</label>
												<label class="radio">
														<input type="radio" name="ManyDueType" value="false">
													<span></span>
													Due ติดกับ Due
												</label>
											</div>
										</div>

									</td>
								</tr>

								<tr class="text-start  fw-bold fs-7 text-uppercase gs-0">
									<th class="text-end  text-gray-400 pe-3 min-w-100px">
										จำนวนของข้อมูลใน 1 ชุด
										:
									</th>
									<td class="text-end pe-3 min-w-50px">
											<input class="form-control" type="text" name="ManyDueDataLong" style="width: 50%;">
									</td>
								</tr>
								<tr class="text-start  fw-bold fs-7 text-uppercase gs-0">
									<th class="text-end  text-gray-400 pe-3 min-w-100px">
										จำนวนของชุดข้อมูลใน 1 แถว
										:
									</th>
									<td class="text-end pe-3 min-w-50px">
											<input class="form-control" type="text" name="ManyDueDataNo" style="width: 50%;">
									</td>
								</tr>
								<tr class="text-start  fw-bold fs-7 text-uppercase gs-0">
									<th class="text-end  text-gray-400 pe-3 min-w-100px">
										ความยาวตัวอักษรของข้อมูล
										1 ชุด
										:
									</th>
									<td class="text-end pe-3 min-w-50px">
											<input class="form-control " type="text" name="ManyDueSetNo" style="width: 50%;">
									</td>
								</tr>
								<tr class="text-start  fw-bold fs-7 text-uppercase gs-0">
									<th class="text-end  text-gray-400 pe-3 min-w-100px">
										ประเภทไฟล์
										:
									</th>
									<td class="text-end pe-3 min-w-50px">
											<select class="form-select form-select-sm form-select-solid w-200px" name="HaveSeperator">
											<option value="true" selected="selected" >
												แถวข้อมูลมีตัวคั่นเช่น , | Tab
											</option>
											<option value="false">เป็นแถวข้อมูลที่ไม่มีตัวคั่น</option>

										</select>
									</td>
								</tr>
								<tr class="text-start  fw-bold fs-7 text-uppercase gs-0">
									<th class="text-end  text-gray-400 pe-3 min-w-100px"></th>
									<td class="text-end pe-3 min-w-50px">
											<select class="form-select form-select-sm form-select-solid w-200px" name="Seperator">
											<option value="," selected="selected">,</option>
											<option value="|">|</option>
											<option value="Tab">Tab</option>

										</select>
									</td>
								</tr>
									<tr class="text-start  fw-bold fs-7 text-uppercase gs-0">
										<th class="text-end  text-gray-400 pe-3 min-w-100px">
											โน๊ตช่วยจำ
											:
										</th>
										<td class="text-end pe-3 min-w-50px">
											<input class="form-control " type="text" name="Note">
										</td>
									</tr>
								<!--end::Table row-->
								<!--end::Table head-->

							</tbody>
						</table>
						<!--end::Table-->
						<div class="d-flex justify-content-center">
							<a class="btn btn-sm fw-bold btn-primary me-2" onclick="addDataTypeCus()">บันทึก</a>
							<a class="btn btn-sm fw-bold btn-secondary me-2">ยกเลิก</a>
						</div>

					</div>
					<div class="card-body">
						<!--begin::Table-->
						<table class="table align-middle fs-6 gy-3 table-striped table-bordered "  @*id="kt_table_widget_5_table"*@>
							<!--begin::Table head-->
							<thead>
								<!--begin::Table row-->
								<tr class="text-start  fw-bold fs-7 text-uppercase gs-0">
									<th class="text-start  text-gray-400 pe-3 min-w-10px">#</th>
									<th class="text-start  text-gray-400 pe-3 min-w-100px">
										ฟิลด์ :
									</th>
									<th class="text-center  text-gray-400 pe-3 min-w-100px">
										ชุดข้อมูล(นับจาก0)
									</th>
									<th class="text-center  text-gray-400 pe-3 min-w-100px">
										ตำแหน่งสิ้นสุด(สำหรับไม่มีตัวขั้น)
									</th>

								</tr>

								<!--end::Table row-->
							</thead>
							<!--end::Table head-->
							<tbody id="select_body">

							</tbody>
						</table>
						<!--end::Table-->


					</div>
					<!--end::Card body-->
				</div>
				<!--end::Table Widget 5-->
			</div>
			<!--end::Col-->
		</div>
		<!--end::Row-->
		</form>
	</div>
	<!--end::Content container-->
</div>

<!--::popup-->
<div class="modal fade" id="modal_add_user"  style="display: none;" >
	<!--begin::Modal dialog-->
	<div class="modal-dialog modal-dialog-centered mw-650px">
		<!--begin::Modal content-->
		<div class="modal-content">
			<!--begin::Modal header-->
			<div class="modal-header" id="kt_modal_add_user_header">
				<!--begin::Modal title-->
				<h2 class="fw-bold">รายการประเภทข้อมูล</h2>
				<!--end::Modal title-->
				<!--begin::Close-->
				<div class="btn btn-icon btn-sm btn-active-icon-primary"  onclick="showDialogAddUser()">
					<i class="ki-duotone ki-cross fs-1">
						<span class="path1"></span>
						<span class="path2"></span>
					</i>
				</div>
				<!--end::Close-->
			</div>
			<!--end::Modal header-->
			<!--begin::Modal body-->
			<div class="modal-body px-5 my-7">
				<!--begin::Form-->
				<form id="kt_modal_add_user_form" class="form" action="#" onsubmit="return false">
					<!--begin::Scroll-->
					<div class="d-flex flex-column scroll-y px-5 px-lg-10" id="kt_modal_add_user_scroll" data-kt-scroll="true" data-kt-scroll-activate="true" data-kt-scroll-max-height="auto" data-kt-scroll-dependencies="#kt_modal_add_user_header" data-kt-scroll-wrappers="#kt_modal_add_user_scroll" data-kt-scroll-offset="300px" style="max-height: 475px;">
						<!--begin::Input group-->
						<!--end::Input group-->
						<!--begin::Input group-->
						<div class="fv-row mb-7">
							<!--begin::Label-->
							<label class=" fw-semibold fs-6 mb-2">ประเภทข้อมูล </label>
							<!--end::Label-->
							<!--begin::Input-->
							<input type="text" id="type_name" class="form-control form-control-solid mb-3 mb-lg-0">
							<!--end::Input-->
							<button type="submit" class="btn btn-primary mt-4" onclick="addDataType()">บันทึก</button>

						</div>
						<!--end::Input group-->

					</div>
					<!--end::Scroll-->

				</form>
				
				<div class="card-body">
					<!--begin::Table-->
					<table class="table align-middle fs-6 gy-3 table-striped table-bordered " id="kt_table_widget_5_table">
						<!--begin::Table head-->
						<thead>
							<!--begin::Table row-->
							<tr class="text-start  fw-bold fs-7 text-uppercase gs-0">
								<th class="text-start  text-gray-400 pe-3 min-w-10px">#</th>
								<th class="text-start  text-gray-400 pe-3 min-w-100px">
									ฟิลด์ :
								</th>
								<th class="text-center  text-gray-400 pe-3 min-w-100px">
									Action
								</th>
							</tr>

							<!--end::Table row-->
						</thead>
						<!--end::Table head-->
						<tbody id="data_type">
							<tr>
								<td class="text-start  pe-3 min-w-10px">1</td>
								<td class="text-start  pe-3 min-w-100px">P/O</td>
								<td class="text-center  pe-3 min-w-100px">
									<i class="ki-duotone ki-pencil me-3">
										<button class="btn btn-warning">แก้ไข</button>
									</i><i class="ki-duotone ki-trash">
										<button class="btn btn-danger">ลบ</button>
									</i>
								</td>
							</tr>
							<tr>
								<td class="text-start  pe-3 min-w-10px">2</td>
								<td class="text-start  pe-3 min-w-100px">Forecast</td>
								<td class="text-center  pe-3 min-w-100px">
									<i class="ki-duotone ki-pencil me-3">
										<span class="path1"></span>
										<span class="path2"></span>
									</i><i class="ki-duotone ki-trash">
										<span class="path1"></span>
										<span class="path2"></span>
										<span class="path3"></span>
										<span class="path4"></span>
										<span class="path5"></span>
									</i>
								</td>
							</tr>
							<tr>
								<td class="text-start  pe-3 min-w-10px">3</td>
								<td class="text-start  pe-3 min-w-100px">Schedule</td>
								<td class="text-center  pe-3 min-w-100px">
									<i class="ki-duotone ki-pencil me-3">
										<span class="path1"></span>
										<span class="path2"></span>
									</i><i class="ki-duotone ki-trash">
										<span class="path1"></span>
										<span class="path2"></span>
										<span class="path3"></span>
										<span class="path4"></span>
										<span class="path5"></span>
									</i>
								</td>
							</tr>
							<tr>
								<td class="text-start  pe-3 min-w-10px">4</td>
								<td class="text-start  pe-3 min-w-100px">SCP</td>
								<td class="text-center  pe-3 min-w-100px">
									<i class="ki-duotone ki-pencil me-3">
										<span class="path1"></span>
										<span class="path2"></span>
									</i><i class="ki-duotone ki-trash">
										<span class="path1"></span>
										<span class="path2"></span>
										<span class="path3"></span>
										<span class="path4"></span>
										<span class="path5"></span>
									</i>
								</td>
							</tr>
							<tr>
								<td class="text-start  pe-3 min-w-10px">5</td>
								<td class="text-start  pe-3 min-w-100px">Paki</td>
								<td class="text-center  pe-3 min-w-100px">
									<i class="ki-duotone ki-pencil me-3">
										<span class="path1"></span>
										<span class="path2"></span>
									</i><i class="ki-duotone ki-trash">
										<span class="path1"></span>
										<span class="path2"></span>
										<span class="path3"></span>
										<span class="path4"></span>
										<span class="path5"></span>
									</i>
								</td>
							</tr>
							<tr>
								<td class="text-start  pe-3 min-w-10px">6</td>
								<td class="text-start  pe-3 min-w-100px">Export</td>
								<td class="text-center  pe-3 min-w-100px">
									<i class="ki-duotone ki-pencil me-3">
										<span class="path1"></span>
										<span class="path2"></span>
									</i><i class="ki-duotone ki-trash">
										<span class="path1"></span>
										<span class="path2"></span>
										<span class="path3"></span>
										<span class="path4"></span>
										<span class="path5"></span>
									</i>
								</td>
							</tr>
						</tbody>
					</table>
					<!--end::Table-->


				</div>
				<!--end::Form-->
			</div>
			<!--end::Modal body-->
		</div>
		<!--end::Modal content-->
	</div>
	<!--end::Modal dialog-->
</div>
<!--end::popup-->

<script>

	const clickCheckBox=(checkbox)=>{
		if(checkbox.checked){
			checkbox.checked = true;
			checkbox.value = true;
		}else{
			checkbox.checked = false;
			checkbox.value = false;
		}
	}

	const showDialogAddUser = ()=>
	{
		let modal = document.getElementById("modal_add_user");
		modal.classList.toggle("show")
		if(modal.classList.contains("show")){
			modal.style.display = "block";

		}else{
			modal.style.display = "none";
		}
	}

	const check_select_change=(value)=>{

		let same_value_counter = 0;
		document.getElementById("select_body").querySelectorAll("select").forEach(select =>{
		if (value === select.value) {
			same_value_counter++;
		}
		if(same_value_counter > 1){
			Swal.fire('ฟิวล์ นี้ถูกใช้งานไปแล้ว');
		}

		});
	}

	window.onload = async () => {

		const table_body = document.getElementById("select_body");
		let field = "";
		for(let count=0; count < 20;count++){
			field += `								<tr>
											<td class="text-start  pe-3 min-w-10px">${count}</td>
										<td class="text-center  pe-3 min-w-100px">
													<select class="form-select form-select-sm form-select-solid w-200px" name="FieldsList[${count}][Name]" onchange="check_select_change(this.value)">
													<option  selected=""></option>
													<option >DueDate-DMY</option>
													<option >DueDate-Dชื่อย่อYY</option>
													<option >DueDate-Dชื่อย่อYYYY</option>
													<option >DueDate-MDY</option>
													<option >DueDate-YMD</option>
													<option >DueTime</option>
													<option >Flag01</option>
													<option >Flag02</option>
													<option >Flag03</option>
													<option >Flag04</option>
													<option >Flag05</option>
													<option >Flag06</option>
													<option >Flag07</option>
													<option >Flag08</option>
													<option >Flag09</option>
													<option >Flag10</option>
													<option >ImportByCoding</option>
													<option >OrderNo</option>
													<option >PartNo</option>
													<option >Period</option>
													<option >PlantCode</option>
													<option >PONo</option>
													<option >Qty</option>
													<option>กำหนด Dueโดย TKC</option>

											</select>
										</td>
										<td class="text-center pe-3 min-w-100px">
													<input type="text" class="text-center" name="FieldsList[${count}][StartPosition]">
										</td>
											<td class="text-center pe-3 min-w-100px">
													<input type="text" class="text-center" name="FieldsList[${count}][EndPosition]">
											</td>
									</tr>`;
		}
		table_body.innerHTML = field;


		const selectCustumer = document.getElementById("custumer_select");
		const listUser = await fetch("/order/JsonCustumer");
		const users_json = await listUser.json();
		selectCustumer.innerHTML = users_json.reduce((prev, curr) => prev += `<option value="${curr?.custID}">${curr?.custID}-${curr?.custName} </option>`, `<option selected > </option>`);
		
		const dataType = await fetch("/order/JsonDataType_MS");
		const data_type = await dataType.json();
		const select_data_type = document.getElementById("select_data_type");
		select_data_type.innerHTML = data_type.reduce((prev, curr) => prev += `<option value="${curr?.typeCode}">${curr?.typeCode}-${curr?.typeName}</option>`, "<option selected></option>");
		const modal_data_type = document.getElementById("data_type");
		modal_data_type.innerHTML = data_type.reduce((prev, curr, index) => prev += `							
								<tr>
										<td class="text-start  pe-3 min-w-10px">${index+1}</td>
										<td class="text-start  pe-3 min-w-100px">${curr?.typeName}</td>
									<td class="text-center  pe-3 min-w-100px">
										<i class="ki-duotone ki-pencil me-3">
												<button class="btn btn-warning" disabled>แก้ไข</button>
										</i><i class="ki-duotone ki-trash">
												<button class="btn btn-danger" disabled>ลบ</button>
										</i>
									</td>
								</tr>`,"");

		const select_mix = document.getElementById("select_mixSchWidth");
		select_mix.innerHTML = data_type.reduce((prev, curr) => prev += `<option value="${curr?.typeCode}">${curr?.typeName}</option>`, "<option selected value='99'>99-ไม่รวม</option>");
	};


	const addDataType = ()=>{
		const name = document.getElementById("type_name");
		fetch("/Order/AddDataType?name=" + name.value, { method: "post" }).then(res => res.json()).then(data => {
			if (data.msg) {
				Swal.fire({
					position: 'top-end',
					icon: 'success',
					title: data.msg,
					showConfirmButton: false,
					timer: 1500
				}).then(resault => {
					window.location.reload();
				});
			} else {
				Swal.fire('Error > ' + data.error);
			}
		}).catch(error => console.log(error));

	}

	const addDataTypeCus =()=>{
		const form = document.getElementById("data_type_form");
		const formData = new FormData(form);
		fetch("/Order/AddCustDataType", { body: formData,method:"post" }).then(res => res.json()).then(data => {
			if (data.msg) {
				Swal.fire({
					position: 'top-end',
					icon: 'success',
					title: data.msg,
					showConfirmButton: false,
					timer: 1500
				}).then(resault => {
					window.location.reload();
				});
			} else {
				Swal.fire('Error > ' + data.error);
			}
		}).catch(error => console.log(error));
	}
</script>
